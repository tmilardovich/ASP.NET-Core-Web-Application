@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center">
    <br />
    @if (User.Identity.IsAuthenticated)
    {
        @if (User.IsInRole("2"))
        {
            <div class="alert alert-success" role="alert">
                You are logged in as publisher. Share something with others!
            </div>
        }
        else if (User.IsInRole("1"))
        {
            <div class="alert alert-success" role="alert">
                You are logged in as reader. Read news from all over the world!.
            </div>
        }
        else
        {
            <div class="alert alert-success" role="alert">
                You are logged in as admin. Welcome.
            </div>
        }
        <h1 class="display-2">Welcome @User.Identity.Name</h1><br />


    }
    else
    {
        <h1 class="display-2">Welcome</h1><br />
    }


    <div id="alert" style="display:none">
        <div class="alert alert-warning alert-dismissible fade show" role="alert">
            <div id="alertM">
                <strong>Thank you for visiting.</strong> Please wait while we register you...
            </div>
            
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    </div>



    <div class="container">
        <div class="row">
            <div class="col bg-secondary">
                <p class="display-5">
                    <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-journal-richtext" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 1h8a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2h1a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1H2a2 2 0 0 1 2-2z" />
                        <path d="M2 5v-.5a.5.5 0 0 1 1 0V5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H2zm0 3v-.5a.5.5 0 0 1 1 0V8h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H2zm0 3v-.5a.5.5 0 0 1 1 0v.5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H2z" />
                        <path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5zm0-2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm1.639-4.208l1.33.886 1.854-1.855a.25.25 0 0 1 .289-.047L11 4.75V7a.5.5 0 0 1-.5.5h-5A.5.5 0 0 1 5 7v-.5s1.54-1.274 1.639-1.208zM6.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5z" />
                    </svg> Be a journalist.
                </p>
                <p class="display-4">
                    <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-chat-dots" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M2.678 11.894a1 1 0 0 1 .287.801 10.97 10.97 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8.06 8.06 0 0 0 8 14c3.996 0 7-2.807 7-6 0-3.192-3.004-6-7-6S1 4.808 1 8c0 1.468.617 2.83 1.678 3.894zm-.493 3.905a21.682 21.682 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a9.68 9.68 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105z" />
                        <path d="M5 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z" />
                    </svg> Share your thoughts.
                </p>
                

                <p class="text-black-50">
                    <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-newspaper" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M0 2A1.5 1.5 0 0 1 1.5.5h11A1.5 1.5 0 0 1 14 2v12a1.5 1.5 0 0 1-1.5 1.5h-11A1.5 1.5 0 0 1 0 14V2zm1.5-.5A.5.5 0 0 0 1 2v12a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 .5-.5V2a.5.5 0 0 0-.5-.5h-11z" />
                        <path fill-rule="evenodd" d="M15.5 3a.5.5 0 0 1 .5.5V14a1.5 1.5 0 0 1-1.5 1.5h-3v-1h3a.5.5 0 0 0 .5-.5V3.5a.5.5 0 0 1 .5-.5z" />
                        <path d="M2 3h10v2H2V3zm0 3h4v3H2V6zm0 4h4v1H2v-1zm0 2h4v1H2v-1zm5-6h2v1H7V6zm3 0h2v1h-2V6zM7 8h2v1H7V8zm3 0h2v1h-2V8zm-3 2h2v1H7v-1zm3 0h2v1h-2v-1zm-3 2h2v1H7v-1zm3 0h2v1h-2v-1z" />
                    </svg> Read the statuses of other members or read the headlines of other popular sites, such as The New York Times, CNN, SkyNews etc.
                </p>
            </div><br /><br />
            @if (!User.Identity.IsAuthenticated)
            {
                <div class="col bg-light">
                    <p class="display-4">Registration</p><br />
                    <form class="text-left">
                        <div class="row">
                            <div class="col">
                                <input type="text" class="form-control" placeholder="First name" id="firstName">
                            </div>
                            <div class="col">
                                <input type="text" class="form-control" placeholder="Last name" id="lastName">
                            </div>
                        </div><br />
                        <div class="form-group">

                            <input type="email" class="form-control" id="email" placeholder="Enter email">
                            <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
                        </div>
                        <div class="form-group">
                            <label for="username">Username</label>
                            <input type="text" class="form-control" id="username" placeholder="Enter username">

                        </div>
                        <div class="form-group">
                            <label for="pass">Password</label>
                            <input type="password" class="form-control" id="pass" placeholder="Password">
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="radio" id="readerRadio" value="reader" checked name="radio">
                            <label class="form-check-label" for="readerRadio">
                                reader
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" id="publisherRadio" value="publisher" name="radio">
                            <label class="form-check-label" for="publisherRadio">
                                publisher
                            </label>
                        </div>
                        <br />


                    </form>
                </div>
            }

        </div>

    </div>
</div>
<br />
@if (!User.Identity.IsAuthenticated)
{
    <div class="text-center">

        <button type="button" class="btn btn-success btn-lg" id="btnRegister" onclick="reg()">Register</button>
        <a asp-controller="Home" asp-action="Login">Already have account? Login.</a>
    </div>
}



<script type="text/javascript">




    function reg() {
        
        var x = document.getElementById("alert");
        x.style.display = "block";
        document.getElementById("alertM").innerHTML = "<strong>Thank you for visiting.</strong> Please wait while we register you...";

        var fn = document.getElementById("firstName").value;
        var ln = document.getElementById("lastName").value;
        var em = document.getElementById("email").value;
        var username = document.getElementById("username").value;
        var pass = document.getElementById("pass").value;
        var radio;
        if (document.getElementById("readerRadio").checked) {
            radio = "reader"
        }
        else {
            radio = "publisher"
        }

        if (fn == "" || ln == "" || em == "") {
            alert("Enter name, surname and email.");
            return;
        }

        if (username == "") {
            alert("Enter username");
            return;
        }
        if (pass.length < 4) {
            alert("Password length min 4 characters.");
            return;
        }


        ax(fn, ln, em, username, pass, radio)



        async function ax(fn, ln, em, username, pass, radio) {
            await axios.post('/api/users/saveuser2',
                {
                    "name": fn,
                    "surname": ln,
                    "email": em,
                    "username": username,
                    "password": pass,
                    "typeName": radio,
                    "userId": null
                }).then(function (response) {
                    if (response.status == 200) {

                        window.location = "/auth/login";
                    }
                    
                    
                }).catch(function (error) {
                    console.log(error.response.data);
                    document.getElementById("alertM").innerHTML = "Username already exists.";
                });

        }


    }
</script>